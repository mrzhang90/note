<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
    console.log('get方法用于拦截某个属性的读取操作。')
    var person={
        name:'张三'
    }
    var proxy=new Proxy(person,{
        get:function(target,property){
            if(property in target){
                console.log(target[property])
                return target[property];
            }else{
//                throw new Error("Property "+property+" does not exist");
                console.error("Property "+property+" does not exist");
            }
        }
    })
    proxy.name;//"张三"
    proxy.age;//抛错误

    console.log('下面的例子使用get拦截，实现数组读取负数的索引。');
    function createArray(...elements){
        let handler={
            get:function(target,propKey,receiver){
                var index=Number(propKey);
                if(index<0){
                    propKey=target.length+propKey;
                }
                return Reflect.get(target,propKey,receiver)
            }
        }
        var target=[];
        target.push(...elements)
        return new Proxy(target,handler);
    }
    var arr=createArray(1,2,3);
    console.log(arr[1])

    console.log('\n利用 Proxy，可以将读取属性的操作（get），转变为执行某个函数，从而实现属性的链式操作。');
    var pipe=(function(){
        return function(value){
            var funcStack=[];
            var oproxy=new Proxy({},{
                get:function(pipeObject,fnName){
                    if(fnName==='get'){
                        return funcStack.reduce(function(val,fn){
                            return fn(val);
                        },value)
                    }
                    funcStack.push(window[fnName]);
                    return oproxy;
                }
            })
            return oproxy;
        }
    })()
    var double=n=>n*2;
    var pow=n=>n*n;
    var reverseInt=n=>n.toString().split("").reverse().join("") | 0;
    console.log(pipe(3).double.pow.reverseInt.get);
</script>
</body>
</html>